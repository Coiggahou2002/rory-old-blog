<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="本文所有 ArrayList 源码引用来源于 Oracle JDK 1.8  特点概述ArrayList 是 Java 集合框架中的动态数组，支持随机访问（即常数时间内通过下标索引可以直接访问具体位置的元素），支持自动扩容，用户不需要关心数组大小，底层实现类似于 C++ 中的 std::vector 基本原理ArrayList 的底层没什么神秘的，在它的底层实现中，存放元素的容器仍然是一个普通的">
<meta property="og:type" content="article">
<meta property="og:title" content="JDK 8 ArrayList 源码分析">
<meta property="og:url" content="https://coiggahou2002.github.io/post/arraylist_src.html">
<meta property="og:site_name" content="Coiggahou2002">
<meta property="og:description" content="本文所有 ArrayList 源码引用来源于 Oracle JDK 1.8  特点概述ArrayList 是 Java 集合框架中的动态数组，支持随机访问（即常数时间内通过下标索引可以直接访问具体位置的元素），支持自动扩容，用户不需要关心数组大小，底层实现类似于 C++ 中的 std::vector 基本原理ArrayList 的底层没什么神秘的，在它的底层实现中，存放元素的容器仍然是一个普通的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20220817170854.png">
<meta property="article:published_time" content="2022-08-17T04:05:00.000Z">
<meta property="article:modified_time" content="2022-08-19T04:50:08.925Z">
<meta property="article:author" content="Coiggahou">
<meta property="article:tag" content="数据结构">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="源码分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20220817170854.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>JDK 8 ArrayList 源码分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/Coiggahou2002">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/post/algo_rem_search.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/post/skiplist.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://coiggahou2002.github.io/post/arraylist_src.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://coiggahou2002.github.io/post/arraylist_src.html&text=JDK 8 ArrayList 源码分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://coiggahou2002.github.io/post/arraylist_src.html&is_video=false&description=JDK 8 ArrayList 源码分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JDK 8 ArrayList 源码分析&body=Check out this article: https://coiggahou2002.github.io/post/arraylist_src.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://coiggahou2002.github.io/post/arraylist_src.html&name=JDK 8 ArrayList 源码分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://coiggahou2002.github.io/post/arraylist_src.html&t=JDK 8 ArrayList 源码分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">特点概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">核心参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">扩容机制源码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-add-%E6%96%B9%E6%B3%95%E5%85%A5%E6%89%8B"><span class="toc-number">5.1.</span> <span class="toc-text">从 add 方法入手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">扩容函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E4%B8%B4%E7%95%8C%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">扩容临界情况分析???</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E7%9A%84%E4%BB%A3%E4%BB%B7%E5%9D%87%E6%91%8A%E5%88%86%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">基于默认参数的代价均摊分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%AE%B9%E9%87%8F%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">与容量相关的函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%93todo%E2%80%93%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">9.</span> <span class="toc-text">–todo–迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E-Vector-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">10.</span> <span class="toc-text">与 Vector 的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%B7%AE%E5%88%AB"><span class="toc-number">10.1.</span> <span class="toc-text">线程安全差别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E5%B7%AE%E5%88%AB"><span class="toc-number">10.2.</span> <span class="toc-text">扩容机制差别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">11.</span> <span class="toc-text">一些其他问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-Arrays-copyOf-%E6%96%B9%E6%B3%95"><span class="toc-number">11.1.</span> <span class="toc-text">关于 Arrays.copyOf() 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transient-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">11.2.</span> <span class="toc-text">transient 关键字的作用是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#modCount-%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F"><span class="toc-number">11.3.</span> <span class="toc-text">modCount 是做什么的？</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        JDK 8 ArrayList 源码分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Coiggahou</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-08-17T04:05:00.000Z" itemprop="datePublished">2022-08-17</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Java/" rel="tag">Java</a>, <a class="tag-link-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a>, <a class="tag-link-link" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="tag">源码分析</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>本文所有 ArrayList 源码引用来源于 Oracle JDK 1.8</p>
</blockquote>
<h2 id="特点概述"><a href="#特点概述" class="headerlink" title="特点概述"></a>特点概述</h2><p>ArrayList 是 Java 集合框架中的动态数组，支持随机访问（即常数时间内通过下标索引可以直接访问具体位置的元素），支持自动扩容，用户不需要关心数组大小，底层实现类似于 <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/container/vector">C++ 中的 std::vector</a></p>
<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>ArrayList 的底层没什么神秘的，在它的底层实现中，<strong>存放元素的容器仍然是一个普通的数组</strong>（至于 transient 这个修饰符是什么意思，我们放到后面再讨论）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br></pre></td></tr></table></figure>

<p>那自动扩容的基本原理是什么呢？</p>
<p>艺术源于生活，程序设计也源于生活，想象你有一个用来装书的箱子，一开始它可能是一个小箱子，但随着你放进去的书越来越多，它很快就满了。</p>
<p>这个时候如果还有新的书要放进来，一般我们会找一个更大的箱子，然后把旧的书一次性移动到新的箱子里面，然后再把新书放进去，然后把旧的箱子扔掉。</p>
<p>自动扩容的基本原理和上面一样，每次插入新元素的时候检查一下，如果数组已经满了，那么就另外开辟一个容量更大的数组，然后把原来数组上放的东西搬进去，再插入新的元素（旧的数组会自动被垃圾回收，无需手动释放）</p>
<p>问题来了：<strong>我们在选择新箱子的时候，选择多大的箱子呢？</strong></p>
<p>我不知道你会选什么 size 的</p>
<p>但你至少肯定不会选一个刚刚好只能多放一本书的箱子，否则你下次再需要放新书的时候，又要再找一个新的箱子，再费力气把旧书全部再转移一遍，你肯定不想这么做。</p>
<p>基于这种想法，<strong>ArrayList 的扩容行为会默认将容量扩大至当前容量的 1.5 倍</strong></p>
<p>那为什么是 1.5 呢？这个参属下 ArrayList 综合表现如何？</p>
<p>我们先不讨论这个问题，放到文章后面来分析</p>
<p>我们先来总结一下，我们上面说了这么多，其实用下面这一句话可以概括：</p>
<p><strong>扩容时的搬运行为是有代价的，我们希望在合理利用空间的前提下，将扩容的次数尽可能减少，从而让搬运的总代价降低，让搬运的总代价平摊到每一次插入元素的时候，小到几乎能够忽略不计。</strong></p>
<h2 id="核心参数"><a href="#核心参数" class="headerlink" title="核心参数"></a>核心参数</h2><p>ArrayList 维护两个计数变量 <code>size</code> 和 <code>capacity</code></p>
<p>size 指的是实际装入的有效元素的个数</p>
<p>capacity 指的是 <code>elementData[]</code> 的实际长度，因为可以通过 <code>elementData.length</code> 获取，所以没有显式地维护 <code>capacity</code> 变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> size;</span><br></pre></td></tr></table></figure>

<p>可以通过下面两个函数（来自源码）很容易看出 <code>size</code> 指的是有效元素个数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是跟容量相关的常量，默认初始容量是 10</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 数组最大容量限制 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ARRAY_SIZE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 默认初始容量 */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>


<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><p><code>public ArrayList()</code></p>
<p>使用不带参的构造函数，按默认参数生成一个容量为 10 的空 ArrayList</p>
<p><code>public ArrayList(int initialCapacity)</code></p>
<p><code>public ArrayList(Collection&lt;? extends E&gt; c)</code></p>
<h2 id="扩容机制源码分析"><a href="#扩容机制源码分析" class="headerlink" title="扩容机制源码分析"></a>扩容机制源码分析</h2><h3 id="从-add-方法入手"><a href="#从-add-方法入手" class="headerlink" title="从 add 方法入手"></a>从 add 方法入手</h3><p>基于我们的认识，扩容一般发生在添加元素的过程中，所以，我们从 add 方法入手分析，看看整个过程的调用链长什么样子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在正式添加元素之前，会调用 <code>ensureCapacityInternal()</code> 方法来确保容量已经足够，并且传入的要求最小容量是当前元素个数 size + 1（因为 add 方法就是要插入一个元素，所以扩容后至少应该多一个位置）</p>
<p>我们进入该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ensureExplicitCapacity</code> 的意思是“显式地保证容量”</p>
<p><code>calculateCapacity</code> 方法的作用是：根据传入的 elementData[] 和 minCapacity，计算出最终应该扩充的容量是多少</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="扩容函数"><a href="#扩容函数" class="headerlink" title="扩容函数"></a>扩容函数</h3><p>我们知道，插入元素的时候，如果位置不够，ArrayList 会自动扩容</p>
<p>而最终执行扩容动作的，就是这个 <code>grow()</code> 函数</p>
<p>它的参数 <code>minCapacity</code> 用于指定扩容后的最小容量 (desired minimum capacity)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// minCapacity 是对扩容后的容量的最低要求</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 旧容量，在扩容之前已经满了，所以等于数组长度</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 新容量是旧容量的约1.5倍</span></span><br><span class="line">    <span class="comment">// 注意：当oldCapacity超过容量上限的2/3时，newCapacity会溢出变成负数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果新容量达不到最低要求，就使用最低要求作为新容量</span></span><br><span class="line">    <span class="comment">// 此处使用a-b&lt;0而不是a&lt;b的形式，是为了防止溢出情况下newCapacity变成负数导致if内永真</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查即将使用的新容量是否超过最大容量限制，如果超过就生成一个大容量作为替代</span></span><br><span class="line">    <span class="comment">// 此处使用a-b&lt;0而不是a&lt;b的形式，也是为了防止溢出？</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复制元素到扩容后的新数组，替换引用指向，完成扩容</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="扩容临界情况分析"><a href="#扩容临界情况分析" class="headerlink" title="扩容临界情况分析???"></a>扩容临界情况分析???</h2><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hermi0ne/p/14814344.html">Java中的overflow-conscious code</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/33147339/difference-between-if-a-b-0-and-if-a-b">Difference between if (a - b &lt; 0) and if (a &lt; b)</a></li>
<li><a target="_blank" rel="noopener" href="https://mail.openjdk.org/pipermail/core-libs-dev/2010-March/003736.html">https://mail.openjdk.org/pipermail/core-libs-dev/2010-March/003736.html</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8557832/cant-understand-the-possibility-of-overflow-when-resizing-arraylist-in-java">Can’t understand the possibility of overflow when resizing ArrayList in Java</a></li>
</ul>
<p>我们应该已经注意到了，在上面扩容机制的源码分析中，我们遇到了很多次这个注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// overflow-conscious code</span></span><br></pre></td></tr></table></figure>

<p>这个注释的意思是告诉我们，<strong>注释下方的代码是考虑了溢出情况的</strong></p>
<p>这里我们主要讨论一下 <code>ensureExplicitCapacity()</code> 和 <code>grow()</code> 方法中的溢出问题</p>
<p>先看前者</p>
<p>代码中想判断的逻辑其实很直接，就是 <code>minCapacity &gt; elementData.length</code> 是否成立，这个逻辑非常自然，因为如果现在 <code>elementData.length &gt;= minCapacity</code>，那按照这个函数本身的责任（保证数组至少拥有 minCapacity 的容量）已经完成了，就不需要调用 <code>grow()</code> 了</p>
<p>所以，逻辑是没有问题的。</p>
<p>但是，参数是不可信的。</p>
<p>如果传进来的参数是个负数怎么办？</p>
<p>为什么我要怀疑它是个负数？</p>
<p>尽管它的本意不是这样的，但它有可能在传进来之前的某一次计算中溢出，变成了负数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>grow 函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="基于默认参数的代价均摊分析"><a href="#基于默认参数的代价均摊分析" class="headerlink" title="基于默认参数的代价均摊分析"></a>基于默认参数的代价均摊分析</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_ARRAY_SIZE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* ..其他代码.. */</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* ..其他代码.. */</span></span><br><span class="line">    </span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从默认参数可以看到，ArrayList 的默认起始容量是 10，每次扩容，容量变成当前的 1.5 倍；最大容量限制是 <code>Integer.MAX_VALUE-8</code>，为了方便，我们假设最大容量是 <code>Integer.MAX_VALUE</code>，也就是 <code>2^31-1</code></p>
<p>我们基于这套参数，进行基于以下假设的均摊分析：</p>
<ul>
<li>假设插入元素的代价为 1（无需扩容的情况下）</li>
<li>假设搬运 1 个元素的代价为 1</li>
<li>假设一个比较坏的情况，所有操作都是在数组尾部插入，没有访问和删除，而且每次只插入 1 个元素</li>
</ul>
<p>从初始容量一直插入，直至达到最大容量限制，假设我们需要 $x$ 次扩容，则有<br>$$<br>10\times(1.5)^x \approx 2^{31}-1<br>$$<br><img src="https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20220817170854.png"></p>
<p>可以得到，这中间我们需要扩容的次数是 48 次</p>
<p>第 1 次扩容，我们需要搬运 10 个元素，代价为 10</p>
<p>第 2 次扩容，代价为 15</p>
<p>第 3 次扩容，代价为 22</p>
<p>……</p>
<p>第 48 次扩容，代价为 $10\times(1.5)^{47}$</p>
<p>我们把所有扩容的代价加起来，由等比求和，得到总代价 $T$<br>$$<br>T &#x3D; 10\times(1.5^0+1.5^1+…+1.5^{47}) \approx 2.64<br>$$<br>所以，在最坏的操作序列（一直插入单个元素）情况下，所有扩容操作均摊到每次操作上的代价是 2.6 左右</p>
<p>而每次插入单个元素的操作，代价都是 1（基于我们的假设）</p>
<p>所以，通过上述的均摊分析，我们得到，<strong>ArrayList 的单次尾部插入均摊代价为 3.6 左右，仍然是常数级别的时间</strong></p>
<p>回顾一下我们上文中说的话：</p>
<p><strong>扩容时的搬运行为是有代价的，我们希望在合理利用空间的前提下，将扩容的次数尽可能减少，从而让搬运的总代价降低，让搬运的总代价平摊到每一次插入元素的时候，小到几乎能够忽略不计。</strong></p>
<p>这个参数下的 ArrayList，确实达到了我们的目的</p>
<h2 id="与容量相关的函数"><a href="#与容量相关的函数" class="headerlink" title="与容量相关的函数"></a>与容量相关的函数</h2><p><code>trimToSize()</code> 将 capacity 缩成与 size 一样大</p>
<p><code>ensureCapacity(int minCapacity)</code></p>
<p><code>calculateCapacity(Object[] elementData[], int minCapacity)</code></p>
<h2 id="–todo–迭代器"><a href="#–todo–迭代器" class="headerlink" title="–todo–迭代器"></a>–todo–迭代器</h2><p>待补充</p>
<h2 id="与-Vector-的对比"><a href="#与-Vector-的对比" class="headerlink" title="与 Vector 的对比"></a>与 Vector 的对比</h2><h3 id="线程安全差别"><a href="#线程安全差别" class="headerlink" title="线程安全差别"></a>线程安全差别</h3><p>ArrayList 的源码注释中有这样一句话</p>
<blockquote>
<p>This class is roughly equivalent to <tt>Vector</tt>, except that it is unsynchronized.</p>
</blockquote>
<p>ArrayList 与 Vector 大体上是差别很小的，最大的区别就是 ArrayList 不是线程安全，而 Vector 是线程安全的</p>
<h3 id="扩容机制差别"><a href="#扩容机制差别" class="headerlink" title="扩容机制差别"></a>扩容机制差别</h3><p>默认扩容倍数有差别</p>
<h2 id="一些其他问题"><a href="#一些其他问题" class="headerlink" title="一些其他问题"></a>一些其他问题</h2><h3 id="关于-Arrays-copyOf-方法"><a href="#关于-Arrays-copyOf-方法" class="headerlink" title="关于 Arrays.copyOf() 方法"></a>关于 Arrays.copyOf() 方法</h3><h3 id="transient-关键字的作用是什么"><a href="#transient-关键字的作用是什么" class="headerlink" title="transient 关键字的作用是什么"></a>transient 关键字的作用是什么</h3><p>看源码的时候，我心中有一个疑问：</p>
<p>为什么要使用 <code>transient</code> 关键字修饰 <code>elementData[]</code>？</p>
<p>我 Google 了一下，找到了这个回答：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/910374/why-does-java-have-transient-fields">Why does Java have transient fields?  —Stack Overflow</a></p>
<p>下面是从回答中摘抄的一段话</p>
<blockquote>
<p>The <code>transient</code> keyword in Java is used to indicate that a field should not be part of the serialization (which means saved, like to a file) process.</p>
</blockquote>
<p>谷歌翻译中，transient 的中文含义是 “瞬态的，瞬时的，短暂的”</p>
<p>Java 中 <code>transient</code> 关键字的作用是告诉 JVM，在将这个类的对象序列化的时候，不要序列化这个加了 transient 的字段，因为这个字段只是对象的一个“短暂的状态”，我们不想要将它持久化。</p>
<p>现在我搞清楚了 transient 的含义和作用</p>
<p>那为什么 ArrayList 要这样做呢？</p>
<p>因为 ArrayList 自己重写了 <code>writeObject()</code> 和 <code>readObject()</code> 方法</p>
<h3 id="modCount-是做什么的？"><a href="#modCount-是做什么的？" class="headerlink" title="modCount 是做什么的？"></a>modCount 是做什么的？</h3><p>如何通过 modCount 检测 <code>ConcurrentModificationException</code> ?</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1668901/java-modcount-arraylist">Java Modcount (ArrayList)</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/Coiggahou2002">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">特点概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">核心参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">扩容机制源码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-add-%E6%96%B9%E6%B3%95%E5%85%A5%E6%89%8B"><span class="toc-number">5.1.</span> <span class="toc-text">从 add 方法入手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">扩容函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E4%B8%B4%E7%95%8C%E6%83%85%E5%86%B5%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">扩容临界情况分析???</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E7%9A%84%E4%BB%A3%E4%BB%B7%E5%9D%87%E6%91%8A%E5%88%86%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">基于默认参数的代价均摊分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%AE%B9%E9%87%8F%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">与容量相关的函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%93todo%E2%80%93%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">9.</span> <span class="toc-text">–todo–迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E-Vector-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">10.</span> <span class="toc-text">与 Vector 的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%B7%AE%E5%88%AB"><span class="toc-number">10.1.</span> <span class="toc-text">线程安全差别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E5%B7%AE%E5%88%AB"><span class="toc-number">10.2.</span> <span class="toc-text">扩容机制差别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">11.</span> <span class="toc-text">一些其他问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-Arrays-copyOf-%E6%96%B9%E6%B3%95"><span class="toc-number">11.1.</span> <span class="toc-text">关于 Arrays.copyOf() 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transient-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">11.2.</span> <span class="toc-text">transient 关键字的作用是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#modCount-%E6%98%AF%E5%81%9A%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F"><span class="toc-number">11.3.</span> <span class="toc-text">modCount 是做什么的？</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://coiggahou2002.github.io/post/arraylist_src.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://coiggahou2002.github.io/post/arraylist_src.html&text=JDK 8 ArrayList 源码分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://coiggahou2002.github.io/post/arraylist_src.html&is_video=false&description=JDK 8 ArrayList 源码分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JDK 8 ArrayList 源码分析&body=Check out this article: https://coiggahou2002.github.io/post/arraylist_src.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://coiggahou2002.github.io/post/arraylist_src.html&title=JDK 8 ArrayList 源码分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://coiggahou2002.github.io/post/arraylist_src.html&name=JDK 8 ArrayList 源码分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://coiggahou2002.github.io/post/arraylist_src.html&t=JDK 8 ArrayList 源码分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2022
    Coiggahou
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/Coiggahou2002">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
